<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ember-skeleton Test Suite</title>
  <link rel="stylesheet" href="qunit/qunit.css" />
  <script src="qunit/qunit.js"></script>
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture">test markup</div>

  <script type="text/javascript">
  (function() {
      window.Ember = { config: {} };

      var syncForTest = function(fn) {
        var callSuper;

        if (typeof fn !== "function") { callSuper = true; }

        return function() {
          var override = false;
          if (Ember.run && !Ember.run.currentRunloop) {
            Ember.run.begin();
            override = true;
          }

          if (callSuper) {
            var ret = this._super.apply(this, arguments);
          } else {
            var ret = fn.apply(this, arguments);
          }

          if (override) {
            Ember.run.end();
          }

          return ret;
        }
      }

      Ember.config.overrideAccessors = function() {
        Ember.set = syncForTest(Ember.set);
        Ember.get = syncForTest(Ember.get);
      };

      Ember.config.overrideClassMixin = function(ClassMixin) {
        ClassMixin.reopen({
          create: syncForTest()
        })
      };

      Ember.config.overridePrototypeMixin = function(PrototypeMixin) {
        PrototypeMixin.reopen({
          destroy: syncForTest()
        })
      };

      // HELPER FUNCTIONS

        /*Ember.View.reopen({
          _insertElementLater: syncForTest()
        });*/

        window.clickRelLink = function(view, relName) {
          var selector = 'a[rel=' + relName + ']',
              element = view.$().find(selector);
          ok(element);
          element.click();
          return element;
        };

        window.appendIntoDOM = function(view) {
          Ember.run(function() {
            view.append() ;
          });
        };

        window.isAppendedToDOM = function(view) {
          return view.$() && view.$().length > 0;
        };

        window.isDestroyed = function(object) {
          return object.get('isDestroyed');
        };

        window.documentHasSelector = function(selector) {
          return jQuery(selector).length > 0;
        };

        window.destroyIfNecessary = function(object) {
          if (object && !object.get('isDestroyed')) {
            object.destroy();
          }
        };

      // /HELPER FUNCTIONS
      //});

    })();
  </script>
  <script src="../assets/loader.js"></script>
  <script src="../assets/app.js"></script>
  <script src="../assets/app-tests.js"></script>
  <script>
    (function(QUnit) {
      // Hack QUnit to not suck for Ember objects
      var originalTypeOf = QUnit.jsDump.typeOf;
      QUnit.jsDump.typeOf = function(obj) {
        if (typeof Ember !== 'undefined' && Ember.Object.detectInstance(obj)) {
          return 'emberObject';
        }

        return originalTypeOf.call(this, obj);
      };

      QUnit.jsDump.setParser('emberObject', function(obj) {
        return obj.toString();
      });

      var matcher = /^tests\//, modules = loader.modules;
      for (var name in modules) {
        if (modules.hasOwnProperty(name)) {
          if (matcher.test(name)) {
            loader.require(name);
          }
        }
      }
    })(QUnit);
  </script>
</body>
</html>
