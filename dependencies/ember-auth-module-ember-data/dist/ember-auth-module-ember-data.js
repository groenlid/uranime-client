// Generated by EmberScript 0.0.7
var get$ = Ember.get;
Em.onLoad('Ember.Application', function (application) {
  application.initializer({
    name: 'ember-auth.module.ember-data',
    before: 'ember-auth-load',
    initialize: function (container, app) {
      app.register('authModule:emberData', get$(get$(Em, 'Auth'), 'EmberDataAuthModule'), { singleton: true });
      app.inject('authModule:emberData', 'auth', 'auth:main');
      return app.inject('authModule:emberData', 'store', 'store:main');
    }
  });
  return application.initializer({
    name: 'ember-auth.module.ember-data-load',
    after: 'ember-auth-load',
    initialize: function (container, app) {
      return container.lookup('authModule:emberData');
    }
  });
});// Generated by EmberScript 0.0.7
var get$ = Ember.get;
var set$ = Ember.set;
set$(get$(Em, 'Auth'), 'EmberDataAuthModule', Ember.Object.extend({
  init: function () {
    get$(this, 'auth')._config('emberData', get$(this, '_defaultConfig'));
    null != get$(this, 'config') || set$(this, 'config', get$(this, 'auth')._config('emberData'));
    this.patch();
    get$(this, 'auth').reopen({ user: get$(Em, 'computed').alias('module.emberData.user') });
    get$(this, 'auth').addHandler('signInSuccess', get$(this, 'findUser').bind(this));
    get$(this, 'auth').addHandler('signInError', get$(this, 'clearUser').bind(this));
    return get$(this, 'auth').addHandler('signOutSuccess', get$(this, 'clearUser').bind(this));
  },
  _defaultConfig: { userModel: false },
  user: null,
  findUser: function () {
    var this$;
    if (!(null != get$(get$(this, 'auth'), 'userId') && get$(get$(this, 'config'), 'userModel')))
      return;
    return get$(this, 'store').find(get$(get$(this, 'config'), 'userModel'), get$(get$(this, 'auth'), 'userId')).then((this$ = this, function (user) {
      return set$(this$, 'user', user);
    }));
  },
  clearUser: function () {
    return set$(this, 'user', null);
  },
  patch: function () {
    var self;
    self = this;
    return get$(DS, 'RESTAdapter').reopen({
      ajax: function (url, type, settings) {
        return this._super(url, type, get$(get$(self, 'auth'), '_strategy').serialize(settings || {}));
      }
    });
  }
}));